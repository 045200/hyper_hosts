name: è‡ªåŠ¨æ›´æ–° Hosts (åŒ—äº¬æ—¶é—´)

on:
  schedule:
    - cron: '0 0,12 * * *'  # UTC 0ç‚¹å’Œ12ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´8ç‚¹å’Œ20ç‚¹ï¼‰
  workflow_dispatch:        # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    env:
      TZ: Asia/Shanghai     # å¼ºåˆ¶åŒ—äº¬æ—¶é—´æ—¶åŒº

    steps:
    # æ£€å‡ºä»£ç 
    - uses: actions/checkout@v4
      name: æ£€å‡ºä»“åº“
      with:
        persist-credentials: false

    # è®¾ç½®Pythonç¯å¢ƒ
    - uses: actions/setup-python@v5
      name: åˆå§‹åŒ–Python
      with:
        python-version: "3.10"

    # å®‰è£…ä¾èµ–å¹¶æ‰§è¡Œè„šæœ¬
    - name: ç”Ÿæˆhostsæ–‡ä»¶
      run: |
        pip install -r requirements.txt
        python dl.py || exit 1
        [ -f "hosts.txt" ] || (echo "âŒ hosts.txtæœªç”Ÿæˆ"; exit 1)

    # æäº¤å˜æ›´
    - name: æ¨é€æ›´æ–°
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        
        if git diff --quiet hosts.txt; then
          echo "ğŸŸ¢ æ— å†…å®¹å˜æ›´"
        else
          git add hosts.txt
          git commit -m "è‡ªåŠ¨æ›´æ–°äº $(date '+%Y-%m-%d %H:%M') åŒ—äº¬æ—¶é—´"
          git push
          echo "ğŸ”µ å·²æäº¤æ–°ç‰ˆæœ¬"
        fi
